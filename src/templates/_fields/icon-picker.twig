{% import '_includes/forms.twig' as forms %}

{% set id = id ?? "selectize#{random()}" %}
{% set value = value ?? null %}
{% set small = small ?? false %}
{% set static = static ?? false %}

{% set hasValue = iconName and iconSet %}
{% tag 'div' with {
    id,
    class: {
        'icon-picker': true,
        small,
    }|filter|keys,
} %}
    {% tag 'div' with {
        class: {
            'icon-picker--icon': true,
            small,
        }|filter|keys,
        title: hasValue ? value : false,
        role: hasValue ? 'img' : false,
        lang: craft.app.getTargetLanguage() starts with 'en' ? false : 'en',
        aria: {
            label: hasValue ? value : false,
        },
    } %}
        {% if hasValue %}
            {{ iconify(iconSet, iconName) }}
        {% endif %}
    {% endtag %}

    {% if not static %}
        {{ forms.button({
            class: {
                'icon-picker--choose-btn': true,
                small,
                hidden: hasValue and small,
            }|filter|keys,
            label: hasValue ? 'Change'|t('app') : 'Choose'|t('app'),
        }) }}

        {{ forms.button({
            class: {
                'icon-picker--remove-btn': true,
                small,
                hidden: not hasValue,
            }|filter|keys,
            label: 'Remove'|t('app'),
        }) }}

        {% if name ?? false %}
            {{- hiddenInput("#{name}[name]", iconName) -}}
            {{- hiddenInput("#{name}[set]", iconSet) -}}
            {{- hiddenInput("#{name}[color]", iconColor ?? '') -}}
            {{- hiddenInput("#{name}[strokeWidth]", iconStrokeWidth ?? '') -}}
        {% endif %}

    {% endif %}
{% endtag %}
{% set fieldsNamePrefix = "fields[#{name}]" %}
{% js %}
new Craft.iconify('#{{ id|namespaceInputId }}', {
    iconSets: {{ iconSets|json_encode|raw }},
    defaultSet: "{{ defaultSet|raw }}",
    fieldsNamePrefix: "{{ fieldsNamePrefix|raw }}"
  });
{% endjs %}
